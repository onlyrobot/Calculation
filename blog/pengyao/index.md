# 目录

1. [需求分析](#需求分析)
2. [软件设计](#软件设计)
3. 代码实现
4. 软件测试
5. 最终效果

## 需求分析

1. 能够自动生成小学四则运算题目
2. 输入命令可以自动生成一千道不重复的题目，并写入到文件备用，不重复的定义为如下：
    > 任何两道题不能通过有限次的+和×左右的运算表达变换为同一道题。例如23+45=和45+23=是重复的题，6×8=和8×6=也是重复的题，类似的多个数字之间如果存在这种关系也不是同一道题，如3+1+2=和1+2+3=也是重复的。
3. 能够对表达式进行求值并有以下要求：
   1. 表达式最多可达10个运算符，括号的数量不限
   2. 除了整数以外还要支持真分数的四则运算。（例如1/6+1/8=7/24）
   3. 程序可以接受用户输入的答案，并判定对错，最后给出总对/错数量。
4. 除四则运算外还支持乘方运算，乘方运算的表达方式有两种，分别是"^"和"**"，要求对两种表达方式都可以支持，并能够通过设置来选择其中一种作为当前表达方式。
5. 用Python语言实现跨平台的图形界面，同时增加“倒计时”功能，每个题目必须在20秒钟以内完成，如果完不成，记0分，并进入下一题。
6. 增加“历史记录”功能，把用户的做题成绩记录下来并可以展现历史记录。
7. 对程序进行有效测试，保证可靠性。

## 软件设计

概要：

* 软件名称：Calculation
* 项目地址：[Github地址](https://github.com/onlyrobot/Calculation)

运行环境/软件配置：

* 编程语言：Python3.7
* 操作系统：Windows10/Linux18.04/Mac
* 代码编辑器：Visual Studio Code
* 性能要求：无

模块结构：

|模块名称     |主要功能|
|-------     |--------|
|expression  |定义了表达式的表示方法、如何从字符串中解析表达式、表达式求值等|
|utilities   |包含处理一些封装好的实用工具，如生成表达式|
|terminal    |负责命令行界面交互过程|
|gui         |负责GUI的显示和交互|
|calculation |主调函数，根据参数的不同决定使用命令行还是图形界面|

数据文件：

|文件名         |用途            |
|--------------|----------------|
|questions.txt |保存生成好的1000个题目|
|score.dat     |保存历史成绩记录|
|setting.cfg   |保存软件配置信息|

面向对象编程：

|class: expression::Expression   |用树型结构表示表达式的对象     |
|-------------------------------|--------------|
|-value: int|一个数字，表示该表达式的值，如果该表达式的值无法用int表示，则该变量置为空|
|-root: Enum|表达式的根节点，可以是操作符或空，当为空的时候表示该表达式是单纯的一个数字|
|-left: Expression|表达式的左节点，如果操作符为空，则左节点也为空，否则为某个子表达式|
|-right: Expression|表达式的右节点，如果操作符为空，则右节点也为空，否则为某个子表达式|
|+constructor(str)|构造函数，从字符串str中解析出表达式|
|+eval(): Expression|计算表达式的值，返回结果是一个表达式（为什么不是单纯的某个数字，因为要支持真分数的运算，而表达式可以表示数字和真分数）|
|+normalization(): Expression|返回正则化后的表达式，便于判断两个表达式是否重复|
|+isRepeated(Expression another): Bool|判断两个表达式是否重复，重复的标准见需求分析，参数不要求是已经正则化的表达式，因为内部会调用正则化函数|
|+toString(): String|返回字符串形式的表达式|

|enum: expression::Operator    |运算符的枚举类，其中枚举类所有的运算符以及它们的优先级|
|-----------------------------|-------------------------------------------------|
|'+':1|加法优先级1|
|'-':1|减法优先级1|
|'*':2|乘法优先级2|
|'/':2|除法优先级2|
|'^':3|乘方优先级3|
|'**':3|乘方优先级3|

函数接口：

|函数名                                     |用途            |参数说明          |返回值说明        |
|-------------------------------------------|----------------|------------------|-----------------|
|utilities::gen_exp(int count, string path): list|生成指定数量的四则运算题目到指定的文件|count: 生成题目的数量；path: 生成的题目放到指定的文件|返回生成的表达式列表|
|utilities::set_cfg(dict pairs): Bool|设置软件的配置参数|键值对组成的字典|返回是否设置成功|
|utilities::get_cfg(list keys): dict|获取软件的配置参数|key值列表|返回获取到的键值对（如果键值对不存在则返回空字典）|

主调函数：

* calculation模块
  
> usage: calculation [option]
>
> or: calculation -n [count] [file]
>
> or: calculation [-n [count]] file
>
> 调用交互界面（默认图形用户界面）或者生成指定数量（默认1000道）的四则运算题目到指定文件file（默认当前目录的questions.txt)中。
>
> -t, --terminal    调用命令行交互界面
>
> -g, --gui         调用图形交互界面
>
> -n, --num         指定生成的题目数量

* terminal模块

> usage: terminal
>
> 调用命令交互界面

* gui模块

> usage: gui
>
> 调用图形交互界面
